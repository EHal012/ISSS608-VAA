{
  "hash": "12ba212b85709dfe2b0a4053b1578a1d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home exercise01\" \ndescription: \"Part1 and Part2\" \ndate: \"May 11, 2025\" \ndate-modified: \"JUL 11, 2025\" \nformat: html\nauthor: \"YUAN Yihao\" \neditor: visual \nexecute: \n  eval: true \n  echo: true \n  warning: false \n  freeze: true \n---\n\n\n\n# Part 1\n\n# 1.0 Overview\n\n## 1.1 Background\n\nAnalysis on demographic structures and distribution of Singapore in 2024\n\n## 1.2 Objective\n\nIdentify the gender distribution by age\n\nIdentify the age distribution by region\n\nConduct more detailed analysis on the regions with distinct characteristics\n\n## 1.3 The Data\n\n*Singapore Residents by Planning Area / Subzone, Single Year of Age and Sex, June 2024* dataset shares by [Department of Statistics, Singapore (DOS)](https://www.singstat.gov.sg/)\n\n# 2. Packages\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(ggiraph, plotly, \n               patchwork, DT, tidyverse) \n```\n:::\n\n\n\n# 3. Getting Started\n\n## 3.1 Importing data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres_data <- read_csv(\"respopagesex2024/respopagesex2024.csv\")\n```\n:::\n\n\n\n## 3.2 Data cleaning\n\n### 3.2.1 Check missing values\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres_data %>% filter(if_any(everything(), is.na))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 0 × 6\n# ℹ 6 variables: PA <chr>, SZ <chr>, Age <chr>, Sex <chr>, Pop <dbl>,\n#   Time <dbl>\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncolSums(is.na(res_data))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  PA   SZ  Age  Sex  Pop Time \n   0    0    0    0    0    0 \n```\n\n\n:::\n:::\n\n\n\n### 3.2.2 Change data values\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres_data <- res_data %>%\n  mutate(Age = ifelse(Age == \"90_and_Over\", \"90\", Age),\n         Age = as.numeric(Age)) \n```\n:::\n\n\n\n### 3.2.3 Check and Convert data type\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(res_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [60,424 × 6] (S3: tbl_df/tbl/data.frame)\n $ PA  : chr [1:60424] \"Ang Mo Kio\" \"Ang Mo Kio\" \"Ang Mo Kio\" \"Ang Mo Kio\" ...\n $ SZ  : chr [1:60424] \"Ang Mo Kio Town Centre\" \"Ang Mo Kio Town Centre\" \"Ang Mo Kio Town Centre\" \"Ang Mo Kio Town Centre\" ...\n $ Age : num [1:60424] 0 0 1 1 2 2 3 3 4 4 ...\n $ Sex : chr [1:60424] \"Males\" \"Females\" \"Males\" \"Females\" ...\n $ Pop : num [1:60424] 10 10 10 10 10 10 10 10 30 10 ...\n $ Time: num [1:60424] 2024 2024 2024 2024 2024 ...\n```\n\n\n:::\n\n```{.r .cell-code}\nres_data <- res_data %>%\n  mutate(\n    Age = as.numeric(Age),\n    Pop = as.numeric(Pop)\n  )\n```\n:::\n\n\n\n### 3.2.4 Data glimpse\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(res_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [60,424 × 6] (S3: tbl_df/tbl/data.frame)\n $ PA  : chr [1:60424] \"Ang Mo Kio\" \"Ang Mo Kio\" \"Ang Mo Kio\" \"Ang Mo Kio\" ...\n $ SZ  : chr [1:60424] \"Ang Mo Kio Town Centre\" \"Ang Mo Kio Town Centre\" \"Ang Mo Kio Town Centre\" \"Ang Mo Kio Town Centre\" ...\n $ Age : num [1:60424] 0 0 1 1 2 2 3 3 4 4 ...\n $ Sex : chr [1:60424] \"Males\" \"Females\" \"Males\" \"Females\" ...\n $ Pop : num [1:60424] 10 10 10 10 10 10 10 10 30 10 ...\n $ Time: num [1:60424] 2024 2024 2024 2024 2024 ...\n```\n\n\n:::\n:::\n\n\n\n# 4. Exploratory Visual Analysis\n\n## 4.1 Population by Age and Sex\n\nThe grey area represents the lower population for males and females. The colored bars represent the number of population exceeded another gender\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggplot2)\n\n\ngrouped_data <- res_data %>%\n  group_by(Age, Sex) %>%\n  summarise(Pop = sum(Pop, na.rm = TRUE), .groups = \"drop\")\n\n\nwide_data <- grouped_data %>%\n  pivot_wider(names_from = Sex, values_from = Pop, values_fill = 0) %>%\n  mutate(\n    min_pop = pmin(Males, Females),\n    male_extra = ifelse(Males > Females, Males - Females, 0),\n    female_extra = ifelse(Females > Males, Females - Males, 0)\n  )\n\n\nggplot() +\n\n  geom_col(data = wide_data, aes(x = Age, y = min_pop), \n           fill = \"gray70\", width = 0.6) +\n\n\n  geom_col(data = wide_data, aes(x = Age, y = male_extra), \n           fill = \"steelblue\", width = 0.6) +\n\n\n  geom_col(data = wide_data, aes(x = Age, y = female_extra), \n           fill = \"tomato\", width = 0.6) +\n\n  labs(\n    title = \"Population by Age and Sex\",\n    x = \"Age\",\n    y = \"Population\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\nObservations: Obviously, in the age range of 0 to 30, the male population is larger than the female population. However, from 30 to 90, the female population is significantly larger than the male population.\n\n## 4.2 Population by Age Group and Planning Area Analyze the number of the aging population in each region.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres_data_grouped <- res_data %>%\n  mutate(AgeGroup = case_when(\n    Age >= 0 & Age <= 20 ~ \"Under Age\",\n    Age >= 21 & Age <= 60 ~ \"Adult\",\n    Age >= 61 ~ \"Aging\"\n  )) %>%\n  group_by(PA, AgeGroup) %>%\n  summarise(Pop = sum(Pop, na.rm = TRUE), .groups = \"drop\")\n\nres_data_grouped_filtered <- res_data_grouped %>%\n  filter(AgeGroup != \"Adult\")\n\nggplot(res_data_grouped_filtered, aes(x = Pop, y = reorder(PA, Pop), fill = AgeGroup)) +\n  geom_col(position = position_dodge(width = 0.9), width = 0.4) +\n  labs(\n    title = \"Population by Age Group and Planning Area\",\n    x = \"Population\",\n    y = \"Planning Area\",\n    fill = \"Age Group\"\n  )+ theme_minimal(base_size = 10) +\n  theme(\n    axis.text.y = element_text(size = 5, margin = margin(r = 5)),\n    legend.position = \"top\",\n    plot.margin = margin(10, 10, 10, 10)\n  )\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\nObservations: Given the large number of regions, it is proposed to construct new variables in order to more intuitively analyze and understand the distribution and proportion of the aging population.\n\n## 4.3 Aging-to-Under-Age Population Ratio by Planning Area\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n\n\nage_summary <- res_data_grouped %>%\n  filter(AgeGroup %in% c(\"Under Age\", \"Aging\")) %>%\n  group_by(PA, AgeGroup) %>%\n  summarise(Total = sum(Pop), .groups = \"drop\")\n\n\nage_ratio <- age_summary %>%\n  tidyr::pivot_wider(names_from = AgeGroup, values_from = Total) %>%\n  mutate(ratio = Aging / `Under Age`)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(age_ratio, aes(x = ratio, y = reorder(PA, ratio))) +\n  geom_col(fill = \"steelblue\") +\n  labs(\n    title = \"Aging-to-Under-Age Population Ratio by Planning Area\",\n    x = \"Aging / Under Age Ratio\",\n    y = \"Planning Area\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.y = element_text(size = 5),\n    plot.title = element_text(face = \"bold\")\n  )\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\nObservation: From this chart, we can see the ranking of regions with a larger proportion of the elderly population.\n\n# PART 2 Peer Learning\n\nComment for 2nd plot in https://pengxinhuang.netlify.app/take-home_ex01/#age-structure-comparison-across-planning-areas\n\npros\n1. Appropriate type of plot. Easier to know the distribution.\n2. Choose some typical area to represent diffirent area's distribution.\n3. Put plots together to compare\n\ncons\n1. X-axis: The data has negative numbers\n2. Y-axis: The text overlaps, and the last group is NA\n3. Overall: The X-axis index of the four pictures are different, which may cause some population misguidance\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres_data <- res_data %>%\n  mutate(Age_group = case_when(\n    Age == \"90_and_Over\" ~ \"90_and_Over\",\n    TRUE ~ paste0(floor(as.numeric(Age) / 10) * 10, \"-\", floor(as.numeric(Age) / 10) * 10 + 9)\n  ))\nagg_data <- res_data %>%\n  group_by(PA, Age_group, Sex) %>%\n  summarise(Pop = sum(Pop, na.rm = TRUE)) %>%\n  ungroup()\nagg_data <- agg_data %>%\n  mutate(Pop_plot = ifelse(Sex == \"Males\", -Pop, Pop))\nggplot(agg_data %>% filter(PA %in% c(\"Bedok\", \"Bukit Timah\", \"Outram\", \"Tampines\")),\n       aes(x = Pop_plot, y = Age_group, fill = Sex)) +\n  geom_bar(stat = \"identity\", width = 0.8) +\n  scale_fill_manual(values = c(\"Males\" = \"steelblue\", \"Females\" = \"tomato\")) +\n  scale_x_continuous(labels = abs) +\n  facet_wrap(~PA, ncol = 2, scales = \"fixed\") +\n  labs(title = \"Population Pyramids of Selected Planning Areas (2024)\",\n    subtitle = \"Representing new township (Tampines), mature estate (Bedok), high-income area (Bukit Timah),\\nand historical district (Outram)\",\n    x = \"Population\",\n    y = NULL,\n    fill = \"Sex\") +\n  theme_minimal() +\n  theme(\n    axis.text.y = element_text(size = 8),\n    plot.subtitle = element_text(size = 9, hjust = 0.5),\n    strip.text = element_text(face = \"bold\")\n  )\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Take-home_Ex01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}